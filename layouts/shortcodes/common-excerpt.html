{{/* å‚æ•°è·å– */}}
{{ $color := .Get "color" | default "#0366d6" }}
{{ $link := .Get "link" }}
{{ $authorLink := .Get "author_link" }}
{{/* æ–°å¢å‚æ•°ï¼šæ˜¯å¦å–æ¶ˆç¼©è¿› */}}
{{ $noIndent := .Get "no_indent" }}

<div class="excerpt-card" id="excerpt-{{ .Ordinal }}" style="border-left-color: {{ $color }};">
    {{/* èƒŒæ™¯è£…é¥°å¼•å· */}}
    <div class="ec-bg-icon" style="color: {{ $color }};">â€œ</div>

    <div class="ec-header">
        <div class="ec-tags">
            {{ with .Get "tag" }}
            <span class="ec-tag" style="background: {{ $color }}10; color: {{ $color }};">
                #{{ . }}
            </span>
            {{ end }}
        </div>
        
        {{/* å³ä¸Šè§’æ“ä½œåŒºï¼šå¤åˆ¶ + è·³è½¬ */}}
        <div class="ec-actions">
            {{ if $link }}
            <a href="{{ $link }}" target="_blank" class="ec-btn link-btn" aria-label="è®¿é—®é“¾æ¥" title="è®¿é—®æ¥æº">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            </a>
            {{ end }}
            
            <button class="ec-btn copy-btn" aria-label="å¤åˆ¶æ‘˜æŠ„" title="å¤åˆ¶å†…å®¹">
                <svg class="icon-copy" viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                <svg class="icon-check" viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><polyline points="20 6 9 17 4 12"></polyline></svg>
            </button>
        </div>
    </div>

    {{/* å†…å®¹åŒºåŸŸ */}}
    <div class="ec-content{{ if $noIndent }} no-indent{{ end }}">
        {{ .Inner | markdownify }}
    </div>

    {{ if or (.Get "from") (.Get "author") }}
    <div class="ec-footer">
        <div class="ec-line"></div>
        <div class="ec-meta-row">
            <div class="ec-info-left">
                {{/* ä½œè€…ä¿¡æ¯ */}}
                {{ with .Get "author" }}
                    <span class="ec-item">
                        <svg class="ec-icon-small" viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        {{ if $authorLink }}
                            <a href="{{ $authorLink }}" target="_blank" class="ec-link-text">{{ . }}</a>
                        {{ else }}
                            {{ . }}
                        {{ end }}
                    </span>
                {{ end }}

                {{/* å‡ºå¤„ä¿¡æ¯ */}}
                {{ with .Get "from" }}
                    <span class="ec-item">
                        <svg class="ec-icon-small" viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="2" fill="none"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                        {{ if $link }}
                            <a href="{{ $link }}" target="_blank" class="ec-link-text linked" style="--hover-color: {{ $color }}">ã€Š{{ . }}ã€‹</a>
                        {{ else }}
                            ã€Š{{ . }}ã€‹
                        {{ end }}
                    </span>
                {{ end }}
            </div>
        </div>
    </div>
    {{ end }}
</div>

<style>
    .excerpt-card {
        /* === Congo é€‚é…å˜é‡ === */
        
        /* â˜€ï¸ äº®è‰²æ¨¡å¼ */
        --ec-bg-card: #f9fafb; /* ææ·¡çš„ç°ï¼Œæ¯”çº¯ç™½æ›´æœ‰è´¨æ„Ÿ */
        --ec-border: rgba(0,0,0,0.06);
        --ec-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); /* æŸ”å’Œé˜´å½± */
        
        --ec-text-content: #374151; /* neutral-700ï¼Œæ·±ç°ï¼Œé˜…è¯»èˆ’é€‚ */
        --ec-text-meta: #6b7280;   /* neutral-500 */
        --ec-line: rgba(0,0,0,0.05);
        
        --ec-btn-bg: transparent;
        --ec-btn-text: #9ca3af;
        --ec-btn-hover-bg: rgba(0,0,0,0.05);
        --ec-btn-hover-text: #1f2937;
        
        --ec-bg-icon-opacity: 0.04; /* éå¸¸æ·¡çš„èƒŒæ™¯æ°´å° */
        
        /* ğŸŒ™ æš—è‰²æ¨¡å¼ (é€‚é… Congo neutral-800) */
        --ec-dark-bg: #1f2937; 
        --ec-dark-border: rgba(255,255,255,0.08);
        --ec-dark-text-content: #e5e7eb; /* neutral-200 */
        --ec-dark-text-meta: #9ca3af;
        --ec-dark-line: rgba(255,255,255,0.08);
        --ec-dark-btn-hover: rgba(255,255,255,0.1);

        position: relative;
        background: var(--ec-bg-card);
        border: 1px solid var(--ec-border);
        border-left-width: 4px; /* ç¨å¾®å‡ç»†å·¦ä¾§è‰²æ¡ */
        border-left-style: solid; 
        border-radius: 8px; /* åœ†è§’ç¨å¾®æ”¹å°ä¸€ç‚¹é€‚é… Congo */
        margin: 2rem 0;
        padding: 20px 24px; /* ç¼©å°å†…è¾¹è· */
        box-shadow: var(--ec-shadow);
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        font-family: inherit;
    }

    /* ğŸŒ™ æš—è‰²æ¨¡å¼é€»è¾‘ */
    @media (prefers-color-scheme: dark) {
        :root:not([data-scheme="light"]) .excerpt-card {
            background: var(--ec-dark-bg);
            border-color: var(--ec-dark-border);
            --ec-text-content: var(--ec-dark-text-content);
            --ec-text-meta: var(--ec-dark-text-meta);
            --ec-line: var(--ec-dark-line);
            --ec-btn-hover-bg: var(--ec-dark-btn-hover);
            --ec-btn-hover-text: #fff;
            box-shadow: none;
        }
    }
    html[data-scheme="dark"] .excerpt-card {
        background: var(--ec-dark-bg);
        border-color: var(--ec-dark-border);
        --ec-text-content: var(--ec-dark-text-content);
        --ec-text-meta: var(--ec-dark-text-meta);
        --ec-line: var(--ec-dark-line);
        --ec-btn-hover-bg: var(--ec-dark-btn-hover);
        --ec-btn-hover-text: #fff;
        box-shadow: none;
    }

    .excerpt-card:hover {
        transform: translateY(-2px);
    }

    /* èƒŒæ™¯å¤§å¼•å· */
    .ec-bg-icon {
        position: absolute;
        top: -10px; /* è°ƒæ•´ä½ç½® */
        right: 15px;
        font-size: 80px; /* è°ƒå°å°ºå¯¸ (åŸ120px) */
        font-family: serif;
        opacity: var(--ec-bg-icon-opacity);
        pointer-events: none;
        line-height: 1;
        z-index: 0;
    }

    /* === é¡¶éƒ¨æ  === */
    .ec-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px; /* å‡å°é—´è· */
        position: relative;
        z-index: 2;
    }

    .ec-tags { display: flex; gap: 8px; }

    .ec-tag {
        font-size: 0.75rem; /* 12px */
        font-weight: 600;
        padding: 3px 8px;
        border-radius: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* æ“ä½œæŒ‰é’® */
    .ec-actions { display: flex; gap: 4px; }
    .ec-btn {
        background: var(--ec-btn-bg);
        border: none; cursor: pointer; color: var(--ec-btn-text);
        width: 28px; height: 28px; /* ç¨å¾®ç¼©å°æŒ‰é’® */
        border-radius: 6px;
        transition: all 0.2s;
        display: flex; align-items: center; justify-content: center;
    }
    .ec-btn:hover {
        background: var(--ec-btn-hover-bg);
        color: var(--ec-btn-hover-text);
    }
    .ec-btn.copy-btn.copied { color: #10b981 !important; /* ç»¿è‰² */ }

    /* === æ ¸å¿ƒå†…å®¹ (é‡ç‚¹ä¿®æ”¹éƒ¨åˆ†) === */
    .ec-content {
        position: relative;
        z-index: 1;
        font-family: inherit;
        
        /* ğŸ”¥ å…³é”®ä¿®å¤ï¼šå­—å·ä» 1.75rem æ”¹ä¸º 1.1rem */
        font-size: 1.1rem; 
        line-height: 1.75; /* å¢åŠ è¡Œé«˜ï¼Œæå‡é˜…è¯»èˆ’é€‚åº¦ */
        
        color: var(--ec-text-content);
        font-weight: 400; /* å»æ‰ä¹‹å‰çš„ 500 åŠ ç²—ï¼Œæ˜¾å¾—æ›´æ¸…ç§€ */
        text-align: justify;
        text-indent: 2em; /* ä¿æŒé¦–è¡Œç¼©è¿›é€»è¾‘ */
    }
    
    .ec-content p { 
        margin-bottom: 0; 
        text-indent: 2em !important; 
    }
    
    /* å–æ¶ˆç¼©è¿›é€»è¾‘ */
    .ec-content.no-indent, 
    .ec-content.no-indent p {
        text-indent: 0 !important;
    }
    
    .ec-content p + p { margin-top: 0.8em; }

    /* === åº•éƒ¨æ  === */
    .ec-footer {
        position: relative;
        z-index: 1;
        margin-top: 20px; /* å‡å°é—´è· */
    }

    .ec-line {
        height: 1px;
        background: var(--ec-line);
        margin-bottom: 10px;
        width: 100%;
    }

    .ec-meta-row {
        display: flex; justify-content: space-between; align-items: center;
        flex-wrap: wrap; gap: 12px;
        font-size: 0.85rem; /* ç¨å¾®è°ƒå°å…ƒæ•°æ®å­—ä½“ */
        color: var(--ec-text-meta);
    }

    .ec-info-left { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .ec-item { display: flex; align-items: center; gap: 5px; }
    .ec-icon-small { opacity: 0.7; }

    .ec-link-text {
        color: inherit; text-decoration: none;
        border-bottom: 1px dashed transparent; transition: all 0.2s;
    }
    .ec-link-text:hover {
        color: var(--hover-color, #0366d6);
        border-bottom-color: var(--hover-color, #0366d6);
    }
    .ec-link-text.linked { border-bottom-color: rgba(0,0,0,0.1); }

    /* ç§»åŠ¨ç«¯å¾®è°ƒ */
    @media (max-width: 600px) {
        .ec-content {
            font-size: 1rem; /* ç§»åŠ¨ç«¯å†å°ä¸€ç‚¹ */
            line-height: 1.6;
            text-align: left; /* ç§»åŠ¨ç«¯å·¦å¯¹é½é€šå¸¸æ›´å¥½çœ‹ */
        }
        .excerpt-card { padding: 16px 20px; }
    }
</style>

<script>
    (function() {
        const cardId = "excerpt-{{ .Ordinal }}";
        const card = document.getElementById(cardId);
        if (!card) return;

        const copyBtn = card.querySelector('.copy-btn');
        if(!copyBtn) return; 

        const iconCopy = copyBtn.querySelector('.icon-copy');
        const iconCheck = copyBtn.querySelector('.icon-check');
        const content = card.querySelector('.ec-content');
        
        const authorText = card.querySelector('.ec-info-left') ? card.querySelector('.ec-info-left').innerText.replace(/\s+/g, ' ').trim() : "";

        copyBtn.addEventListener('click', () => {
            let textToCopy = content.innerText.trim();
            if (authorText) {
                textToCopy += `\n\nâ€”â€” ${authorText}`;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                iconCopy.style.display = 'none';
                iconCheck.style.display = 'block';
                copyBtn.classList.add('copied');

                setTimeout(() => {
                    iconCopy.style.display = 'block';
                    iconCheck.style.display = 'none';
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶");
            });
        });
    })();
</script>