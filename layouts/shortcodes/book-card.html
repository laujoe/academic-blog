{{ $isbn := .Get "isbn" }}
{{ $cover := .Get "cover" }}
{{ $title := .Get "title" }}
{{ $author := .Get "author" }}
{{ $year := .Get "year" }}
{{ $publisher := .Get "publisher" }}
{{ $rawLink := .Get "link" }}

{{/* --- é“¾æ¥æ™ºèƒ½è§£æé€»è¾‘ (ä¿æŒä¸å˜) --- */}}
{{ $finalUrl := $rawLink }}
{{ $target := "_blank" }}
{{ if $rawLink }}
    {{ if hasPrefix $rawLink "http" }}
        {{ $target = "_blank" }}
    {{ else }}
        {{ $target = "_self" }}
        {{ with .Site.GetPage $rawLink }}
            {{ $finalUrl = .Permalink }}
        {{ end }}
    {{ end }}
{{ end }}

<div class="book-card">
    {{/* 1. å°é¢åŒºåŸŸ */}}
    <div class="book-cover-wrapper">
        {{ if $finalUrl }}<a href="{{ $finalUrl }}" target="{{ $target }}" {{ if eq $target "_blank" }}rel="noopener noreferrer"{{ end }}>{{ end }}
            <img src="{{ $cover }}" alt="{{ $title }}" class="book-cover">
        {{ if $finalUrl }}</a>{{ end }}
    </div>

    {{/* 2. ä¿¡æ¯åŒºåŸŸ */}}
    <div class="book-info">
        <div class="book-header">
            <h4 class="book-title">
                {{ if $finalUrl }}
                    <a href="{{ $finalUrl }}" target="{{ $target }}" {{ if eq $target "_blank" }}rel="noopener noreferrer"{{ end }}>{{ $title }}</a>
                {{ else }}
                    {{ $title }}
                {{ end }}
            </h4>

            {{ if $finalUrl }}
            <a href="{{ $finalUrl }}" target="{{ $target }}" {{ if eq $target "_blank" }}rel="noopener noreferrer"{{ end }} class="book-jump-btn" title="è·³è½¬é˜…è¯»">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
            </a>
            {{ end }}
        </div>

        <div class="book-meta">
            <span class="book-author">{{ $author }}</span>
            <span class="separator">â€¢</span>
            <span class="book-year">{{ $year }}</span>
        </div>
        
        <div class="book-publisher">{{ $publisher }}</div>
        
        <div class="book-review">
            <span class="quote-mark">â€œ</span>
            {{ .Inner | markdownify }}
            <span class="quote-mark">â€</span>
        </div>
    </div>
</div>

<style>
/* === ä¹¦å½±å¡ç‰‡æ ·å¼ V4 === */
.book-card {
    display: flex; gap: 24px;
    background: var(--color-neutral-50);
    border: 1px solid rgba(0,0,0,0.06);
    border-radius: 12px;
    padding: 24px;
    margin: 2.5rem 0;
    align-items: flex-start;
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
    
    /* ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šå¼ºåˆ¶ç»§æ‰¿å…¨å±€å­—ä½“ */
    font-family: inherit !important; 
}

.book-card:hover { box-shadow: 0 10px 30px -10px rgba(0,0,0,0.08); }
html[data-scheme="dark"] .book-card { background: #1e1e1e; border-color: rgba(255,255,255,0.1); }

/* å°é¢æ ·å¼ */
.book-cover-wrapper { flex-shrink: 0; width: 110px; perspective: 800px; margin-top: 5px; }
.book-cover {
    width: 100%; border-radius: 4px; display: block;
    box-shadow: 6px 6px 12px rgba(0,0,0,0.2), 1px 1px 0 rgba(255,255,255,0.1) inset;
    transform: rotateY(-15deg); transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    cursor: pointer;
}
.book-cover-wrapper:hover .book-cover { transform: rotateY(0deg) scale(1.02); }

/* ä¿¡æ¯åŒº */
.book-info { flex: 1; display: flex; flex-direction: column; gap: 6px; min-width: 0; }
.book-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }

/* æ ‡é¢˜ */
.book-title { 
    margin: 0 !important; 
    font-size: 1.25rem; 
    font-weight: 800; /* åªä¿ç•™ç²—ç»†ï¼Œå­—ä½“è·Ÿéšç³»ç»Ÿ */
    line-height: 1.3; 
}
.book-title a {
    color: var(--color-neutral-800); text-decoration: none;
    background-image: linear-gradient(var(--color-primary-500), var(--color-primary-500));
    background-size: 0% 2px; background-position: 0 100%; background-repeat: no-repeat;
    transition: background-size 0.3s, color 0.3s;
}
.book-title a:hover { color: var(--color-primary-600); background-size: 100% 2px; }

/* è·³è½¬æŒ‰é’® */
.book-jump-btn {
    color: var(--color-neutral-400); padding: 6px; border-radius: 8px; transition: all 0.2s;
    display: flex; align-items: center; justify-content: center; background: transparent;
}
.book-jump-btn svg { width: 18px; height: 18px; }
.book-jump-btn:hover {
    background: rgba(var(--color-primary-500-rgb), 0.1); color: var(--color-primary-600);
    transform: translateX(2px) translateY(-2px);
}

/* å…ƒæ•°æ® */
.book-meta { font-size: 0.95rem; color: var(--color-neutral-600); font-weight: 500; }
.separator { margin: 0 8px; opacity: 0.3; }
.book-publisher { font-size: 0.85rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--color-neutral-400); margin-bottom: 8px; }

/* è¯„è®ºåŒº (ğŸ”¥ ä¿®æ”¹å¤„ï¼šåˆ é™¤äº† font-familyï¼Œç°åœ¨å®ƒå’Œæ­£æ–‡ä¸€æ ·äº†) */
.book-review {
    /* font-family: "LXGW WenKai Screen", "KaiTi", serif;  <-- å·²åˆ é™¤ */
    font-family: inherit; /* æ˜¾å¼ç»§æ‰¿ */
    background: rgba(0,0,0,0.03); 
    padding: 12px 16px; 
    border-radius: 8px;
    font-size: 1rem; 
    color: var(--color-neutral-700); 
    line-height: 1.7;
    position: relative; 
    border-left: 3px solid var(--color-primary-300);
}
.quote-mark { color: var(--color-primary-400); font-weight: bold; margin: 0 4px; opacity: 0.6; }

@media (max-width: 600px) {
    .book-card { flex-direction: column; align-items: center; padding: 20px; gap: 20px; }
    .book-cover-wrapper { width: 90px; margin: 0; }
    .book-cover { transform: rotateY(0deg); }
    .book-info { align-items: center; text-align: center; width: 100%; }
    .book-header { flex-direction: column-reverse; align-items: center; }
    .book-jump-btn { position: absolute; top: 10px; right: 10px; }
    .book-review { text-align: left; width: 100%; font-size: 0.95rem;}
}
</style>